<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.116.1"><title>Linux Processes - if1live space</title><meta name=author content="if1live"><meta name=title content="Linux Processes"><meta name=description content="ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë° ì‹œí—˜ ê³µë¶€í•˜ë©´ì„œ ì •ë¦¬í•œ ë‚´ìš©ì´ë‹¤. ë‚´ìš© ê°±ì‹ ì€ ì—†ì„ ì˜ˆì •ì´ë‹¤. Linux Processes Processor Execution Modes Dual Mode Operation User Mode Level 3 ê¶Œí•œ ì œí•œë˜ì–´ìˆìŒ ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ Kernel Mode Level 0 ì»¤ë„ì˜"><meta name=keywords content="linux,system programming,process,study"><meta name=naver-site-verification content="2ddc1a56777489f4a64a4f6a59822f8b1c1ea502"><meta name=google-site-verification content="VsvNNnJZUV-iLEYKNju16p-HtDqZeqL15H-VVy-HwpA"><meta name=gc:client-id content="785d47c81cbc2fd42b65"><meta name=gc:client-secret content="5e5d558f0b16fae154aa47fc9d94f7c09e540ec7"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=text/javascript>var host="if1live.github.io";host==window.location.host&&window.location.protocol!="https:"?window.location.protocol="https":console.log("skip https redirect")</script><link rel=stylesheet href=/css/style.ad6245cc6a90c30a30dba42b8bbe9be63bed9ea169e339d8ecfc6b9afc6eb8382bbd422b2d31dc71c3355c79f057ddcaa7e1ca96b5eb7f5f16a28a34e74051db.css integrity="sha512-rWJFzGqQwwow26Qri76b5jvtnqFp4znY7PxrmvxuuDgrvUIrLTHcccM1XHnwV93Kp+HKlrXrf18Wooo050BR2w=="><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin=anonymous><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-3043297488880636",enable_page_level_ads:!0})</script><meta property="og:title" content="Linux Processes"><meta property="og:description" content="ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë° ì‹œí—˜ ê³µë¶€í•˜ë©´ì„œ ì •ë¦¬í•œ ë‚´ìš©ì´ë‹¤. ë‚´ìš© ê°±ì‹ ì€ ì—†ì„ ì˜ˆì •ì´ë‹¤. Linux Processes Processor Execution Modes Dual Mode Operation User Mode Level 3 ê¶Œí•œ ì œí•œë˜ì–´ìˆìŒ ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ Kernel Mode Level 0 ì»¤ë„ì˜"><meta property="og:type" content="article"><meta property="og:url" content="https://if1live.github.io/posts/system-prog-linux-processes/"><meta property="og:image" content="https://www.gravatar.com/avatar/fb9672e7e0d256f39369595381d1ea07?size=160"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-10-17T00:00:00+00:00"><meta property="article:modified_time" content="2014-10-17T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.gravatar.com/avatar/fb9672e7e0d256f39369595381d1ea07?size=160"><meta name=twitter:title content="Linux Processes"><meta name=twitter:description content="ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë° ì‹œí—˜ ê³µë¶€í•˜ë©´ì„œ ì •ë¦¬í•œ ë‚´ìš©ì´ë‹¤. ë‚´ìš© ê°±ì‹ ì€ ì—†ì„ ì˜ˆì •ì´ë‹¤. Linux Processes Processor Execution Modes Dual Mode Operation User Mode Level 3 ê¶Œí•œ ì œí•œë˜ì–´ìˆìŒ ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ Kernel Mode Level 0 ì»¤ë„ì˜"><meta name=twitter:site content="@if1live"><script async src="https://www.googletagmanager.com/gtag/js?id=G-SKE54STL16"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SKE54STL16",{anonymize_ip:!1})}</script></head><body><nav class=sora-navigation><a href=/ title=home><h1>if1live space</h1></a><ul class=menu-button-list><li><a href=/posts title=archive><i class="fa-solid fa-box-archive"></i>
<span hidden>archive</span></a></li><li><a href=/tags title=tags><i class="fa-solid fa-tags"></i>
<span hidden>tags</span></a></li><li><a href=//github.com/if1live title=GitHub><i class="fa-brands fa-github"></i>
<span hidden>GitHub</span></a></li><li><a href=/about title=about><i class="fa-solid fa-info"></i>
<span hidden>about</span></a></li><li><a href=https://if1live.github.io/index.xml title=RSS><i class="fa-solid fa-rss"></i>
<span hidden>RSS</span></a></li></ul></nav><div class=main><section id=single><h1 class=title><span>Linux Processes</span><br><small>2014ë…„ 2í•™ê¸° ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë° ì‹œí—˜ ê³µë¶€</small></h1><div class=tip><time datetime="2014-10-17 00:00:00 +0000 UTC">2014. 10. 17</time></div><div class=content><p>ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë° ì‹œí—˜ ê³µë¶€í•˜ë©´ì„œ ì •ë¦¬í•œ ë‚´ìš©ì´ë‹¤. ë‚´ìš© ê°±ì‹ ì€ ì—†ì„ ì˜ˆì •ì´ë‹¤.</p><h1 id=linux-processes>Linux Processes</h1><h2 id=processor-execution-modes>Processor Execution Modes</h2><ul><li>Dual Mode Operation</li></ul><h3 id=user-mode>User Mode</h3><ul><li>Level 3<ul><li>ê¶Œí•œ ì œí•œë˜ì–´ìˆìŒ</li><li>ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨</li></ul></li></ul><h3 id=kernel-mode>Kernel Mode</h3><ul><li>Level 0<ul><li>ì»¤ë„ì˜ ëª¨ë“  ì˜ì—­ ì ‘ê·¼ ê°€ëŠ¥</li></ul></li><li>ì§„ì…ë°©ë²•<ul><li>system call</li><li>interrupt</li><li>exeception</li></ul></li></ul><h3 id=execution-within-user-processes>Execution Within User Processes</h3><ul><li>ì»¤ë„ì€ ìœ ì € í”„ë¡œì„¸ìŠ¤ì— ë¶™ì–´ì„œ ì‘ë™í•œë‹¤</li><li>Mode Switch = user mode &lt;-> kernel mode</li><li>0~3GB : User Address Space</li><li>3~4GB : Kernel Address Space</li><li>User Address Space/Kernel Address Space ì´ë™ì´ Mode switch</li><li>ì‹¤í–‰ ì†Œìœ ê¶Œì€ ìœ ì €í•œí…Œ ìˆë‹¤. ì»¤ë„ì€ ìœ ì €ì¸¡ì„ ë¹Œë ¤ì„œ ì‚¬ìš©í•˜ëŠ” í˜•íƒœ</li><li>Mode switch overheadëŠ” ë‚®ë‹¤</li></ul><h2 id=processí”„ë¡œì„¸ìŠ¤>Process(í”„ë¡œì„¸ìŠ¤)</h2><ul><li>Process<ul><li>an instance of a running program</li></ul></li></ul><h3 id=í”„ë¡œì„¸ìŠ¤ì˜-êµ¬ì¡°>í”„ë¡œì„¸ìŠ¤ì˜ êµ¬ì¡°</h3><ul><li>Images<ul><li>Code : ê¸°ê³„ì–´(.text)</li><li>Data : ë³€ìˆ˜(.data, .bss)</li><li>Execution Stack : Stack + Heap</li></ul></li><li>Process Context<ul><li>Program Context<ul><li>data registers</li><li>program counter(PC)</li><li>stack pointer(SP)</li></ul></li><li>Kernel Context<ul><li>pid, gid, fs, etc&mldr;</li></ul></li></ul></li></ul><h3 id=process-ë©”ëª¨ë¦¬-êµ¬ì¡°>Process ë©”ëª¨ë¦¬ êµ¬ì¡°</h3><ul><li>.text : program text, code segment, read-only</li><li>.data : initialized data,</li><li>.bss : uninitialized data, í”„ë¡œê·¸ë˜ ì‹¤í–‰ ì „ì— ì»¤ë„ì´ 0ìœ¼ë¡œ ì´ˆê¸°í™”</li><li>stack : ìœ„ì—ì„œ ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°</li><li>heap : ë°‘ì—ì„œ ìœ„ë¡œ ì˜¬ë¼ê°</li><li>library : stackê³¼ heap ì‚¬ì´ì— ì ì ˆíˆ ìœ„ì¹˜</li></ul><h2 id=process--thread-ê°œìš”>Process / Thread ê°œìš”</h2><ul><li>Processì˜ êµ¬ì„± ìš”ì†Œ<ul><li>Process Context</li><li>code, data, stack</li></ul></li><li>Threadì˜ êµ¬ì„± ìš”ì†Œ<ul><li>Thead Context(ì“°ë ˆë“œ ë³„ë¡œ)</li><li>Kernel Context(ê³µìœ )</li><li>code, data, stack</li></ul></li></ul><p>Process Context = Program Context + Kernel Context ë¼ëŠ”ê±¸ ê¸°ì–µí•˜ì.
ì´ë¥¼ ìª¼ê°œì„œ program context(data register, SP, PC)ì˜ ì´ë¦„ì„ Thread Contextë¡œ ë°”ê¿¨ì„ ë¿ì´ë‹¤.</p><h2 id=process-state>Process State</h2><h3 id=general-model>General Model</h3><ul><li>New<ul><li>-> Ready</li></ul></li><li>Ready<ul><li>-> Dispatch -> Running : Scheduler</li></ul></li><li>Running<ul><li>-> Timeout -> Ready</li><li>-> Event Wait -> Blocked</li><li>-> Release -> Exit</li></ul></li><li>Blocked(Waiting)<ul><li>ì˜ˆë¥¼ ë“¤ë©´ I/O ëŒ€ê¸°</li><li>-> Event Occurs -> Ready</li></ul></li><li>Exit</li></ul><h3 id=linux>Linux</h3><ul><li>New Stateê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤</li><li>Ready, Runningì€ ë‘˜ë‹¤ TASK_RUNNING.</li><li>Blockedì˜ ì¢…ë¥˜ê°€ ì„¸ë¶„í™”<ul><li>TASK_INTERRUPTIBLE, TASK_UNINTERRUPTIBLE</li><li>TASK_STOPPED</li></ul></li><li>ì¢…ë£ŒëŠ” EXIT_ZOMBIE ë¥¼ ê±°ì³ì„œ EXIT_DEADë¡œ</li></ul><h2 id=process-descriptor>Process Descriptor</h2><ul><li>PCB(Process Control Block)</li><li>task_struct<ul><li>thread_struct : Program Context</li><li>mm_struct : code, data, stack</li></ul></li></ul><h2 id=process-êµ¬ë¶„>Process êµ¬ë¶„</h2><ul><li>ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ê³ ìœ í•œ process descriptionë¥¼ ê°€ì§</li><li>PID = Process ID, í”„ë¡œì„¸ìŠ¤ì˜ ê³ ìœ í•œ ê°’</li><li>0~32767, ê·¼ë° ì»¤ë„ ì»´íŒŒì¼ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ</li></ul><h2 id=user-stack--kernel-stack>User Stack / Kernel Stack</h2><ul><li>Dual mode operation => Stackë„ 2ê°œ<ul><li>user stack, user mode stack</li><li>kernel stack, kernel model stack</li></ul></li><li>Mode Switch ë°œìƒí• ë•Œ Stackë„ ë°”ë€ë‹¤</li><li>ìŠ¤íƒì„ 2ê°œë¡œ ë¶„ë¦¬í•˜ëŠ” ì´ìœ <ul><li>user stackë§Œ ì¡´ì¬í•˜ë©´ ê½‰ì°¨ì„œ ì»¤ë„ í•¨ìˆ˜ ì‹¤í–‰ ëª»í• ìˆ˜ë„ ìˆë‹¤</li><li>ì»¤ë„ ë³´ì•ˆ</li></ul></li></ul><h3 id=user-stack>User Stack</h3><ul><li>í”„ë¡œì„¸ìŠ¤ë§ˆë‹¤ ê°€ì§„ë‹¤</li><li>ë†’ì€ ì£¼ì†Œì—ì„œ ë‚®ì€ ì£¼ì†Œë¡œ</li><li>ë‚´ìš©ë¬¼<ul><li>í”„ë¡œê·¸ë¨ ì¢…ë£Œí›„ì˜ ë¦¬í„´ ì£¼ì†Œ</li><li>í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¸ì</li><li>í™˜ê²½ ë³€ìˆ˜</li><li>call stack(í•¨ìˆ˜ ì¸ì + ë¦¬í„´ ì£¼ì†Œ)</li><li>ì„ì‹œ ë³€ìˆ˜</li></ul></li></ul><h3 id=kernel-stack>Kernel Stack</h3><ul><li>ì»¤ë„ ëª¨ë“œ ì§„ì…í•˜ê¸° ì „ì— ì»¤ë„ ìŠ¤íƒì— ì‹¤í–‰ ìƒíƒœë¥¼ ì €ì¥í•œë‹¤<ul><li>ì‹¤í–‰ìƒíƒœ : uesr mode stack(SP)ê°™ì€ê±°</li></ul></li><li>ë‚´ìš©ë¬¼<ul><li>í•¨ìˆ˜ ì¸ì + ë¦¬í„´ ì£¼ì†Œ</li><li>ì„ì‹œ ë³€ìˆ˜</li><li>ì¡´ì¬í• ìˆ˜ ìˆëŠ”ê²ƒì€ user stackì™€ ê±°ì˜ ë™ì¼</li></ul></li></ul><h3 id=struct-thread_info>struct thread_info</h3><ul><li>size = 8Kb(í˜ì´ì§€ 2ê°œ í¬ê¸°)</li><li>í¬ë¡œì„¸ìŠ¤ë§ˆë‹¤ í•˜ë‚˜ì”© í• ë‹¹</li><li>unionì„ ì´ìš©í•´ì„œ thread_infoì™€ kernel stackì„ ë™ì‹œì— ì‚¬ìš©</li></ul><h2 id=process-list>Process List</h2><h3 id=all-process-list>All Process List</h3><ul><li>task_structì— ì¡´ì¬í•˜ëŠ” tasksë¡œ ëª¨ë“  process descriptionì€ ì—°ê²°ëœë‹¤. ì´ì¤‘ ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸</li><li>init_task == process 0, swapper</li></ul><h3 id=pidhash-table>pidhash Table</h3><ul><li>0~2047ì˜ í•´ì‹œ í…Œì´ë¸”</li><li>ëª¨ë“  process descriptionê°€ ì—°ê²°ëœ ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì›í•˜ëŠ” pidì˜ process descriptionì„ ì–»ëŠ” ê²ƒì€ ëŠë¦¬ê¸° ë•Œë¬¸ì— í•´ì‹œí…Œì´ë¸” ì‚¬ìš©í•œë‹¤.</li><li>hash collision => chaining</li></ul><h3 id=process-ê´€ê³„ë„>Process ê´€ê³„ë„</h3><ul><li>ì„œë¡œ ë°€ì ‘í•œ ê´€ê³„ê°€ ìˆëŠ” í”„ë¡œì„¸ìŠ¤ë„ ë”°ë¡œ ì—°ê²°ì‹œí‚¨ë‹¤.</li><li>parent</li><li>children</li><li>sibling</li><li>group_leader, thread group leader, &mldr;</li></ul><h3 id=state>State</h3><ul><li>TASK_RUNNING<ul><li>ì‹¤í–‰ ìƒíƒœì˜ í”„ë¡œì„¸ìŠ¤ëŠ” runqueueë¥¼ ì´ìš©í•´ì„œ ì—°ê²°ëœë‹¤.</li><li>ìŠ¤ì¼€ì¤„ë§í• ë•Œ ì ‘ê·¼ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•˜ëŠ”ê²ƒì´ ëª©ì </li><li>ìì„¸í•œ ê²ƒì€ schedulingì—ì„œ ë‹¤ë£¬ë‹¤</li><li>task_structì˜ run_listë¥¼ ì´ìš©í•´ì„œë„ ì—°ê²°</li></ul></li><li>TASK_STOPPED, TASK_ZOMBIE<ul><li>íŠ¹ë³„í•œ ë¦¬ìŠ¤íŠ¸ë¡œ ì—°ê²°í•˜ì§€ ì•ŠëŠ”ë‹¤</li></ul></li><li>TASK_INTERRUPTIBLE, TASK_UNINTERRUPTIBLE<ul><li>ì—¬ëŸ¬ ìë£Œêµ¬ì¡°ì— ì—°ê²°ë¨</li><li>waiting queueì— ì—°ê²°</li></ul></li></ul><h3 id=waiting-queue>Waiting Queue</h3><ul><li>sleeping processesë¡œ êµ¬ì„±ë¨</li><li>íŠ¹ì • ì¡°ê±´ì´ ê°–ì¶°ì§€ë©´ ì‘ì—…ì„ ê¹¨ìš´ë‹¤<ul><li>ë°°íƒ€ì  í”„ë¡œì„¸ìŠ¤, ì ì ˆíˆ í•˜ë‚˜ì”© ì»¤ë„ì´ ê¹¨ìš´ë‹¤</li><li>ë¹„ë°°íƒ€ì  í”„ë¡œì„¸ìŠ¤, ì´ë²¤íŠ¸ ë“¤ì–´ì˜¤ë©´ ë™ì‹œì— ê¹¨ìš°ê¸°</li></ul></li></ul><h2 id=process-switching>Process Switching</h2><ul><li>ë°œìƒ ì¡°ê±´<ul><li>í”„ë¡œì„¸ìŠ¤ê°€ ìŠ¤ìŠ¤ë¡œ ì ë“¤ì—ˆë‹¤</li><li>í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë¨</li><li>í”„ë¡œì„¸ìŠ¤ê°€ ì‹œìŠ¤í…œì½œì„ ëë‚´ê³  ìœ ì €ëª¨ë“œë¡œ ëŒì•„ì˜¤ëŠ”ë° í”„ë¡œì„¸ìŠ¤ë¥¼ ëŒë¦´ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ì ì ˆí•œ ì•„ë‹ˆë‹¤.</li><li>í”„ë¡œì„¸ìŠ¤ê°€ ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬ë¥¼ ëë‚´ê³  ìœ ì €ëª¨ë“œë¡œ ëŒì•„ì™”ëŠ”ë° ìš°ì„ ìˆœìœ„ ë¬¸ì œë¡œ ì‹¤í–‰ìê²©ì´ ì—†ì„ë•Œ<ul><li>time quantumì„ ì „ë¶€ ì¼ë‹¤</li></ul></li></ul></li><li>ê°„ë‹¨í•œ ê³¼ì •<ul><li>context switchë¥¼ í• ì§€, í˜„ì¬ í—ˆìš©ë˜ì–´ìˆëŠ”ì§€ë¥¼ í™•ì¸</li><li>ì˜›ë‚  í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í–‰ìƒíƒœë¥¼ ì €ì¥</li><li>ìŠ¤ì¼€ì¤„ë§ ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì ì ˆíˆ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„ íƒ</li><li>ì„ íƒëœ í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í–‰ìƒíƒœ ë³µêµ¬</li></ul></li><li>ìš©ì–´. ì „ë¶€ ê°™ì€ ëœ»<ul><li>task switching</li><li>context switching</li><li>process switching</li></ul></li><li>ìƒì„¸ ì ˆì°¨<ol><li>ì´ì „ í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í–‰ìƒíƒœ(EIP, ESP, &mldr;)ë¥¼ ì´ì „ í”„ë¡œì„¸ìŠ¤ì˜ ì»¤ë„ ìŠ¤íƒì— ì €ì¥í•œë‹¤</li><li>ì£¼ì†Œ ê³µê°„ì„ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ë¡œ ë³€ê²½</li><li>kernel mode stackë¥¼ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ì˜ ê²ƒìœ¼ë¡œ ë³€ê²½</li><li>hardware contextë¥¼ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ì˜ ê²ƒìœ¼ë¡œ ë³€ê²½</li></ol></li><li>ì´í›„ì˜ ë‚´ìš©ì—ì„œëŠ” 3ê³¼ 4 ì§‘ì¤‘ì ìœ¼ë¡œ ë‹¤ì›€</li></ul><h3 id=hardware-context>Hardware Context</h3><ul><li>í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ê¸°ì „ì— CPU ë ˆì§€ìŠ¤í„°ì— ì˜¬ë ¤ì•¼ í•˜ëŠ” ë°ì´í„°</li><li>thread_struct threadì™€ ì»¤ë„ ìŠ¤íƒì´ ì €ì¥<ul><li>eip, espì™€ ê°™ì€ê²ƒì€ thread_structì— ì €ì¥</li><li>thread_structì— ì—†ëŠ” ìˆ˜ë§ì€ ë ˆì§€ìŠ¤í„°ëŠ” ì»¤ë„ ìŠ¤íƒì— ì €ì¥</li></ul></li></ul><h3 id=process-switch>Process Switch</h3><ul><li>ê´€ë ¨ ì½”ë“œ<ul><li><code>schedule()</code> function</li><li><code>switch_to()</code> macro</li><li><code>__switch_to()</code> macro</li></ul></li><li>switch_to macro ê°œìš”<ul><li>CPU ìƒíƒœë¥¼ ì´ì „ ì»¤ë„ ìŠ¤íƒì— ì €ì¥</li><li><strong>esp</strong>ë¥¼ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ì˜ ê²ƒìœ¼ë¡œ êµì²´</li><li><strong>eip</strong>ë¥¼ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ì˜ ê²ƒìœ¼ë¡œ êµì²´</li><li>ìƒˆë¡œìš´ í”„ë¡œë ˆìŠ¤ ì¤€ë¹„ ì™„ë£Œ</li></ul></li><li>switch_to macro ìƒì„¸<ul><li>flags, ebpì™€ ê°™ì€ CPU ìƒíƒœë¥¼ prev ì»¤ë„ ìŠ¤íƒì— ì €ì¥</li><li>espë¥¼ prev í”„ë¡œì„¸ìŠ¤ thread_structì˜ espì— ì €ì¥</li><li>next í”„ë¡œì„¸ìŠ¤ thread_structì— ìˆëŠ” espë¥¼ espë¡œ</li><li>L1ì„ prev í”„ë¡œì„¸ìŠ¤ thread_structì˜ eipì— ì €ì¥</li><li>next í”„ë¡œì„¸ìŠ¤ thread_structì— ìˆëŠ” eipë¥¼ ìŠ¤íƒìœ¼ë¡œ</li><li>__switch_to macro. ë‚˜ë¨¸ì§€ hardware contextë¥¼ ì €ì¥/êµì²´</li><li>L1 : ìŠ¤íƒì—ì„œ ebp, flagsë¥¼ ë¹¼ì„œ CPUë¡œ ì €ì¥</li></ul></li></ul><h2 id=processthread>Process/Thread</h2><ul><li>ì ‘ê·¼ë²•<ul><li>{one|multiple} Process + {one|multiple} Thread</li><li>4ê°€ì§€ ì¡°í•©ì´ ê°€ëŠ¥</li></ul></li><li>ì „í†µì ì¸ ì ‘ê·¼ë²• : multiple process, one thread<ul><li>ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ê³µìœ ë˜ëŠ” ê²ƒì´ ì—†ë‹¤.</li><li>ê·¸ë˜ì„œ ì¤‘ë³µë˜ëŠ”ê²Œ ë§ë‹¤. ë¹„íš¨ìœ¨ì </li></ul></li><li>Thread êµ¬í˜„ë°©ë²•<ul><li>User-level threads<ul><li>í•œ threadì—ì„œ blockê±¸ë¦¬ë©´ ëª¨ë“  threadê°€ blocked</li></ul></li><li>Kernel-level threads</li><li>combined thread : ì¡íƒ•, íŒ¨ìŠ¤</li></ul></li></ul><h3 id=lightweight-process>Lightweight Process</h3><ul><li>ë¦¬ëˆ…ìŠ¤ì—ì„œ Kernel-level Threadë¥¼ êµ¬í˜„í•œ ë°©ë²•</li><li>ìì›ì„ ê³µìœ í•˜ëŠ” process = Lightweight Process</li><li>Thread Group, ì²«ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ê°€ thread group leader</li><li>ëª¨ë“  ì“°ë ˆë“œëŠ” ê³ ìœ  pidë¥¼ ê°–ëŠ”ë‹¤. ëª¨ë‘ ë…ë¦½ëœ í”„ë¡œì„¸ìŠ¤ì²˜ëŸ¼ ì·¨ê¸‰</li><li>TGID(Thread Group ID)ê°€ ê°™ìœ¼ë©´ í•œ í”„ë¡œì„¸ìŠ¤ì— ë”¸ë¦° ì“°ë ˆë“œì²˜ëŸ¼ ì·¨ê¸‰</li></ul><h4 id=clone>clone()</h4><ul><li><code>clone()</code>ë¥¼ ì´ìš©í•´ì„œ <code>fork()</code>, <code>vfork()</code> êµ¬í˜„</li><li>flags : parent/chlidê°„ì˜ ê³µìœ  ë¦¬ì†ŒìŠ¤ ê²°ì •. ì•„ë¬´ê²ƒë„ ê³µìœ í•˜ì§€ ì•Šìœ¼ë©´ fork</li><li>COW(copy-on-write)<ul><li>ì“°ê¸°í• ë•Œ ì§„ì§œë¡œ ë³µì‚¬í•œë‹¤. ì½ê¸°ì¼ë•ŒëŠ” page ë³µì‚¬ëŠ” ì—†ë‹¤</li><li>ë³µì‚¬ overhead ì œê±°</li><li>forkí–ˆë‹¤ê³  í”„ë¡œì„¸ìŠ¤ ì „ì²´ë¥¼ ë³µì‚¬í•  í•„ìš” ì—†ë‹¤</li><li>Pageë‹¨ìœ„ë¡œ ì´ë£¨ì–´ì§</li><li>forkí›„ì—ëŠ” child ë¨¼ì € ì‹¤í–‰ë¨. childëŠ” ìì‹ ì˜ user stackì— ì“°ê¸°ë¥¼ í• í…Œë‹ˆ forkì§í›„ì— í•„ìš”í•œ í˜ì´ì§€ê°€ ë³µì‚¬ê°€ ì´ë£¨ì–´ì§ˆ ê²ƒì´ë‹¤. ì´ê²ƒì€ schedulingì—ì„œ ë‹¤ì‹œ ë‚˜ì˜´</li></ul></li><li><code>vfork()</code>, <code>fork()</code> -> <code>clone()</code> -> <code>do_fork()</code></li></ul><h4 id=do_fork>do_fork()</h4><ul><li>ìì‹ìš© PID ìƒì„±</li><li><code>copy_process()</code>ë¥¼ ì´ìš©í•´ì„œ process descriptor ë³µì‚¬<ul><li>thread_info, kernel stack ìƒì„±</li><li>ìµœëŒ€ process ê°¯ìˆ˜ í™•ì¸(ìƒì„± ê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ í™•ì¸)</li><li>descriptor, page tableë“±ë“± ë³µì‚¬</li><li>state = TASK_RUNNING</li><li>ë¶€ëª¨ ê´€ê³„ ì„¤ì •</li><li>thread group ê´€ê³„ ì„¤ì •</li></ul></li><li>runqueueì— ìì‹ì„ ì¶”ê°€</li><li>(CLONE_VFORKì¼ ê²½ìš°) ë¶€ë¡œë¥¼ wait queueì— ë„£ìŒ(vforkê°€ forkì™€ ë‹¤ë¥¸ì  : block)</li><li>ìì‹ PIDë¥¼ ë°˜í™˜í•˜ê³  í•¨ìˆ˜ ì¢…ë£Œ</li></ul><h2 id=kernel-thread>Kernel Thread</h2><ul><li><strong>kernel-level threadsì™€ëŠ” ë‹¤ë¥¸ë‹¤, kernel-level threadsì™€ëŠ”!</strong></li><li>ì»¤ë„ì˜ ì¼ë¶€ í•¨ìˆ˜(ë””ìŠ¤í¬ ìºì‹œ flush, swapping,&mldr;)ë¥¼ kernel threadë¡œ ì·¨ê¸‰</li><li>ì»¤ë„ ì“°ë ˆë“œë¥¼ lightweight processì˜ ì¼ì¢…ìœ¼ë¡œ êµ¬í˜„<ul><li>process descriptor, pidë¥¼ ê°€ì§„ë‹¤</li><li><strong>ìŠ¤ì¼€ì¤„ë§ ê°€ëŠ¥</strong>í•˜ë‹¤. í”„ë¡œì„¸ìŠ¤ì²˜ëŸ¼ ì·¨ê¸‰</li><li><strong>kernel modeì—ì„œë§Œ ì‘ë™</strong>í•œë‹¤<ul><li>user mode address spaceê°€ ì—†ë‹¤</li><li>3~4GB ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë§Œ ì¡´ì¬</li></ul></li><li>ë‹¤ë¥¸ ì»¤ë„ ì“°ë ˆë“œì™€ kernel address space ê³µìœ </li><li>kernel data struct(ex: open file descriptor)ë„ ê³µìœ </li></ul></li></ul><h2 id=process-0--swapper>Process 0 == Swapper</h2><ul><li><code>start_kernel()</code>ë¡œ ìƒì„±ë¨</li><li>ëª¨ë“  ì»¤ë„ ìë£Œ êµ¬ì¡° ì´ˆê¸°í™”</li><li>ì¸í„°ëŸ½íŠ¸ í™œì„±í™”</li><li>process 1 ì‹¤í–‰(ì´ê²ƒë„ ì»¤ë„ ì“°ë ˆë“œ)</li><li>process 1 ìƒì„±í›„ <code>cpu_idle()</code> í˜¸ì¶œí•˜ê³  ëŒ€ê¸°</li><li>TASK_RUNNING ìƒíƒœì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ process 0 ì„ íƒ</li><li>ê°ê°ì˜ CPUë§ˆë‹¤ process 0 ì¡´ì¬</li></ul><h2 id=process-1--init>Process 1 == init</h2><ul><li>ì»¤ë„ ì™„ì „íˆ ì´ˆê¸°í™”</li><li>ë‹¤ë¥¸ ì»¤ë„ ì“°ë ˆë“œ ìƒì„±(ex: ksoftirqd)</li><li>ì ˆëŒ€ ì£½ì§€ ì•ŠëŠ”ë‹¤. ëª¨ë“  í”„ë¡œì„¸ìŠ¤ ê°ì‹œ</li></ul><h2 id=í”„ë¡œì„¸ìŠ¤-ëë‚´ê¸°>í”„ë¡œì„¸ìŠ¤ ëë‚´ê¸°</h2><ul><li>í”„ë¡œì„¸ìŠ¤ ëë‚´ëŠ” ë°©ë²•<ul><li>ì¼ë°˜ì ì¸ ë°©ë²• : <code>exit()</code></li><li>ì¼ë°˜ì ì¸ ë°©ë²• ì•„ë‹˜ : ì‹œê·¸ë„ ë³´ëƒ„, SIGKILL</li></ul></li><li>í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ : <code>do_exit()</code><ul><li>ì»¤ë„ ìë£Œêµ¬ì¡° ì œê±°. <code>__exit_mm()</code>, <code>__exit_fs()</code>, &mldr;</li><li>ë¶€ëª¨ê´€ê³„ ê°±ì‹ </li><li>state = TASK_ZOMBIE</li><li><code>schedule()</code> í˜¸ì¶œ, ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„ íƒí•´ì„œ ì‹¤í–‰</li></ul></li><li>í”„ë¡œì„¸ìŠ¤ ì œê±°<ul><li>ë¶€ëª¨ê°€ <code>wait()</code>ì„ í˜¸ì¶œí•´ì„œ ì¢…ë£Œê°’ ì½ê¸° ì „ê¹Œì§€ ì§€ìš°ì§€ ì•ŠëŠ”ë‹¤. ë¶€ëª¨ê°€ exit codeë¥¼ ì½ìœ¼ë©´ ì œê±° ê°€ëŠ¥</li><li><code>release_task()</code> : ì¢€ë¹„ í”„ë¡œì„¸ìŠ¤ì˜ PCB í•´ì œ</li><li>8KB ë©”ëª¨ë¦¬ íšŒìˆ˜ : thread_info + kernel stack</li></ul></li></ul></div><div class=tags><a href=https://if1live.github.io/tags/linux/>linux</a>
<a href=https://if1live.github.io/tags/system-programming/>system programming</a>
<a href=https://if1live.github.io/tags/process/>process</a>
<a href=https://if1live.github.io/tags/study/>study</a></div><hr><div class=pagination><div class="left pagination-item"><a href=https://if1live.github.io/posts/introduce-importd/>ğŸ¡° importd - Django as a micro-framework</a></div><div class="right pagination-item"><a href=https://if1live.github.io/posts/system-prog-linux-process-schduling/>Linux Process Scheduling ğŸ¡²</a></div></div><div class=see-also><h2>See Also</h2><ul><li><a href=/posts/sytem-prog-study-interrupt-and-exceptions/>Interrupt and Exceptions</a></li><li><a href=/posts/system-prog-linux-process-schduling/>Linux Process Scheduling</a></li></ul></div><div id=comment><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//libsora.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></div><footer class=sora-footer><p><a href=//gohugo.io/ title=Hugo>Hugo</a> |
<a href=//twitter.com/if1live/ title=@if1live>@if1live</a></p></footer><script src=/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js integrity="sha512-BttltKXFyWnGZQcRWj6osIg7lbizJchuAMotOkdLxHxwt/Hyo+cl47bZU0QADg+Qt5DJwni3SbYGXeGMB5cBcw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js integrity="sha512-/Rynaa6ehLZJO9fdk+EUsgiOdJqFSFUB4Qgy+gP4vU4U1DrmPJWypfXe1CgyaV7rRdZjGxdpLe9djxhx1ZHvqQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js integrity="sha512-8VrjxGFLIkS0mgEmO3p46A5OkqATHhrNVwyv2V7yUeZrk1jmSDuI3SOEpC9XHEHUWEOsfzzcJeBlUkee9lKGrw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js integrity="sha512-namzGTZvHaug0jeipHRN2pMepMiJj+EbrloktVFlMYGnA0EwZhbdLeENjBYLCgoghVbZGinIz/FFYHmB0o3wLw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js integrity="sha512-uOw7XYETzS/DPmmirpP5UCMihSDNMeyTS965J0/456OSPfxn9xEtHHjj5Q/5WefVdqyMfN/afmQnNpZd/tpkcA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js integrity="sha512-AKaNmg8COK0zEbjTdMHJAPJ0z6VeNqvRvH4/d5M4sHJbQQUToMBtodq4HaV4fa+WV2UTfoperElm66c9/8cKmQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js integrity="sha512-jwrwRWZWW9J6bjmBOJxPcbRvEBSQeY4Ad0NEXSfP0vwYi/Yu9x5VhDBl3wz6Pnxs8Rx/t1P8r9/OHCRciHcT7Q==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js integrity="sha512-xKcnbsdT0KMoA4yrozkqZM1XJVTrPsjdQwvigxlAlxEDu8YDvC/jl+LfVqn0fY3Vs6m2y4a89JCHEIA/Z9zpmQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js integrity="sha512-pmt3kb6dRndjFXFFwCa3rSzuUQ0GjeCfC5QULWde+8ZBIsUzuP1heOIOSAMfAyXHSufrrTp8h7UHw85K4IJ2/g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js integrity="sha512-whYhDwtTmlC/NpZlCr6PSsAaLOrfjVg/iXAnC4H/dtiHawpShhT2SlIMbpIhT/IL/NrpdMm+Hq2C13+VKpHTYw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js integrity="sha512-/Dti0iV9cxgJe8r0U/89YJIv9ZBQu1ExEWffVyBj4juMQ4GNglQ3TQ0Up4gcbiHvg0g87arcUFbKBtw2PxH1Dw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js integrity="sha512-w200Nz1i9KgDNi+IpPMgpZBVRIvfVK/V5vskyHjkz7XJkVnRJcb1uNmpiHhDv0/Ln+GG2VqScKKz/1izBfg64Q==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-less.min.js integrity="sha512-lL5HvfIycntK04Iiai/VTsyuj7mvDkhz9k+cA8fqXr932s4jLJ1YwplIs6Dhpw0pzVwAe1jGe8sGwbyuHG44QQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-scss.min.js integrity="sha512-aczOaJ+mB9uGT6dMJbDaUsS2PWG+XII+1ypFQ0L22Z132V6kMM6m70pQssXsPAFmLI5xkgx/hknBuUuJIJKZfA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js integrity="sha512-uMdVuOpm+9lNPCT7mV/YaMb9YQ/R4+eeON7aEMj6Ig/f4BoU+Q5k6iaZkDsX7LH9cjTHZt0CuKxbzd0/fndrWA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js integrity="sha512-QXFMVAusM85vUYDaNgcYeU3rzSlc+bTV4JvkfJhjxSHlQEo+ig53BtnGkvFTiNJh8D+wv6uWAQ2vJaVmxe8d3w==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js integrity="sha512-6O/PZimM3TD1NN3yrazePA4AbZrPcwt1QCGJrVY7WoHDJROZFc9TlBvIKMe+QfqgcslW4lQeBzNJEJvIMC8WhA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-batch.min.js integrity="sha512-tPgIjUKiv2HcUAIWXA3v6G4cNuWXkoMsF+ibxfHLnp+/s1C3Bw5/qp78+JjhrfoyWIiHXHx0LtH4M/LAwyQqWg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lisp.min.js integrity="sha512-W461RnQzrhSCQQMfEGFKOHbK2DuJTVxrXs2PzctPaxV3A+qPB/TcnMgucSsBNkyccNK8VoENBsAnbf/SuBE71g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin=anonymous></script>
<script>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]});for(var inlineMathArray=document.querySelectorAll("script[type='math/tex']"),inlineMath,tex,replaced,displayMathArray,displayMath,i=0;i<inlineMathArray.length;i++)inlineMath=inlineMathArray[i],tex=inlineMath.innerText||inlineMath.textContent,replaced=document.createElement("span"),replaced.innerHTML=katex.renderToString(tex,{displayMode:!1}),inlineMath.parentNode.replaceChild(replaced,inlineMath);displayMathArray=document.querySelectorAll("script[type='math/tex; mode=display']");for(i=0;i<displayMathArray.length;i++)displayMath=displayMathArray[i],tex=displayMath.innerHTML,replaced=document.createElement("span"),replaced.innerHTML=katex.renderToString(tex.replace(/%.*/g,""),{displayMode:!0}),displayMath.parentNode.replaceChild(replaced,displayMath)</script></body></html>